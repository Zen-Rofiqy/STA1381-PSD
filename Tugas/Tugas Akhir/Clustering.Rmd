---
title: "Tugas Akhir PSD UAS"
author: "Angga Fathan Rofiqy"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    highlight: tango
    code_folding: hide
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    fig_caption: true
pkgdown:
  as_is: true
---

Kode di `Hide` dalam *default*, untuk menampilkan kode, klik `Code` .

```{r, warning=FALSE, message = FALSE}
#                      -=( Install & Load Package Function )=-
install_load <- function (package1, ...)  {   

   # convert arguments to vector
   packages <- c(package1, ...)

   # start loop to determine if each package is installed
   for(package in packages){

       # if package is installed locally, load
       if(package %in% rownames(installed.packages()))
          do.call('library', list(package))

       # if package is not installed locally, download, then load
       else {
          install.packages(package)
          do.call("library", list(package))
       }
   } 
}
```

```{r}
path <- function(){
  gsub  ( "\\\\",  "/",  readClipboard ()  )
}
#Copy path, Panggil function di console
#Copy r path, paste ke var yang diinginkan
```

```{r}
#Export chart
export.chart <- "C:/Users/Fathan/Documents/Obsidian Vault/2. Kuliah/Smt 5/8. Pengantar Sains Data/Tugas/Tugas Akhir/Chart"
```

```{r setup, include=FALSE, echo=FALSE}
#SetWD
require("knitr")
opts_knit$set(root.dir = "C:/Users/Fathan/Documents/Obsidian Vault/2. Kuliah/Smt 5/8. Pengantar Sains Data/Tugas/Tugas Akhir")
```

# Pendahuluan

Fuzzy C-Means (FCM) adalah algoritma pengelompokan lunak yang diusulkan oleh Bezdek (1974; 1981). Berbeda dengan algoritma K-means di mana setiap objek data adalah anggota hanya satu kelompok, objek data adalah anggota dari semua kelompok dengan derajat keanggotaan yang bervariasi antara 0 dan 1 dalam FCM. Oleh karena itu, objek data yang lebih dekat ke pusat kelompok memiliki derajat keanggotaan yang lebih tinggi daripada objek yang tersebar di batas kelompok.

## Data Preprocessing {.tabset}

### Data Entry

```{r, warning=FALSE, message = FALSE}
install_load('rio')
raw.data1 <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1381-PSD/main/Tugas/Tugas%20Akhir/Data%20PSD.csv")

raw.data2 <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1381-PSD/main/Tugas/Tugas%20Akhir/Data%20PSD_Perc.csv")

raw.data3 <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1381-PSD/main/Tugas/Tugas%20Akhir/Data%20PSD_Desa.csv")
```

### Data Checking

> Mengecek Tipe data

```{r}
str(raw.data1)
str(raw.data2)
str(raw.data3)
```

Semua tipe data sudah sesuai.

> Mengecek Data kosong

```{r}
sum(is.na(raw.data1))
sum(is.na(raw.data2))
sum(is.na(raw.data3))
```

Tidak ada data kosong.

### Frekuensi

```{r}
install_load("DT")
datatable(raw.data1, filter = 'top', 
          options = list(pageLength = 10))
```

### Persentase

```{r}
datatable(raw.data2, filter = 'top', 
          options = list(pageLength = 10))
```

### Desa

```{r}
datatable(raw.data3, filter = 'top', 
          options = list(pageLength = 10))
```

## Library

```{r message=FALSE, warning=FALSE}
install_load("ppclust", "factoextra", "dplyr", "cluster", "fclust", "psych", 
             "FactoMineR", "ggplot2", "fmsb")
```

# Eksplorasi

```{r fig.align="center", fig.height=15, fig.width=25, message=FALSE, warning=FALSE, dpi=300}
dtx <- raw.data2[-35,-1]
pairs.panels(dtx, method = "pearson")
```

```{r}
boxplot(dtx)
```

# Clustering

## Fuzzy

```{r}
res.fcm <- fcm(dtx, centers=3)
as.data.frame(res.fcm$u)[1:6,]
```

## **Initial and final cluster prototypes matrices**

```{r}
res.fcm$v0
```

```{r}
res.fcm$v
```

```{r}
summary(res.fcm)
```

## **Run FCM with Multiple Starts**

```{r}
res.fcm <- fcm(dtx, centers=3, nstart=5)

res.fcm$func.val
```

```{r}
res.fcm$iter
```

```{r}
res.fcm$best.start
```

```{r}
summary(res.fcm)
```

## **Pairwise Scatter Plots**

```{r fig.align="center", fig.height=10, fig.width=20, message=FALSE, warning=FALSE, dpi=300}
plotcluster(res.fcm, cp=1, trans=TRUE)
```

## **Cluster Plot with fviz_cluster**

```{r}
set.seed(12333333)
res.fcm2 <- ppclust2(res.fcm, "kmeans")
fviz_cluster(res.fcm2, data = dtx, 
  ellipse.type = "convex",
  palette = "jco",
  repel = TRUE)
```

```{r}
res.fcm2[["size"]]
```

```{r}
data.akhir <- cbind(raw.data2[-35,], Cluster = res.fcm2[["cluster"]]) %>% 
  relocate(Cluster, .before = 2) %>%
  mutate(Cluster = case_when(
    Cluster == 1 ~ "A",
    Cluster == 2 ~ "B",
    Cluster == 3 ~ "C",
    TRUE ~ as.character(Cluster)
  )) %>%
  mutate(Cluster = case_when(
    Cluster == "A" ~ 3,
    Cluster == "B" ~ 2,
    Cluster == "C" ~ 1,
    TRUE ~ as.numeric(Cluster)
  ))


datatable(data.akhir)
```

```{r}
table(data.akhir$Cluster)
```

```{r}
install_load('openxlsx')
#Model Tentatif 
write.xlsx(list("Fuzzy" = data.akhir), 
           file = "Data_Cluster.xlsx")
```

## **Cluster Plot with clusplot**

```{r}
res.fcm3 <- ppclust2(res.fcm, "fanny")

cluster::clusplot(scale(dtx), res.fcm3$cluster,  
  main = "Cluster plot of Iris data set",
  color=TRUE, labels = 2, lines = 2, cex=1)
```

## **VALIDATION OF THE CLUSTERING RESULTS**

```{r}
res.fcm4 <- ppclust2(res.fcm, "fclust")

# Fuzzy Silhouette Index:
idxsf <- SIL.F(res.fcm4$Xca, res.fcm4$U, alpha=1)
paste("Fuzzy Silhouette Index: ",idxsf)
```

```{r}
# Partition Entropy:
idxsf <- PE(res.fcm4$U)
paste("Partition Entropy: ",idxsf)
```

```{r}
# Partition Coefficient:
idxpc <- PC(res.fcm4$U)
paste("Partition Coefficient : ",idxpc)
```

```{r}
# Modified Partition Coefficient:
idxmpc <- MPC(res.fcm4$U)
paste("Modified Partition Coefficient :",idxmpc)
```

# **gap index**

```{r message=FALSE, warning=FALSE}
install_load("clusterSim")
cl1<-pam(dtx,4)
cl2<-pam(dtx,5)
clall<-cbind(cl1$clustering,cl2$clustering)
g<-index.Gap(dtxndefined, clall, reference.distribution="unif", B=10,method="pam")

print(g)
```

# **Davies-Bouldin's index**

```{r}
cl2 <- pam(dtx, 5)
print(index.DB(dtx, cl2$clustering, centrotypes="centroids"))
```

# **Calinski-Harabasz pseudo F-statistic**

```{r}
c<- pam(dtx,10)
index.G1(dtx, c$clustering)
```

# Bi-Plot

```{r}
#Biplot
df = scale(dtx, scale = FALSE)
head(df)
```

```{r}
df_pca = PCA(df, graph = T,scale.unit = T)
```

```{r}
fviz_pca_biplot(df_pca,repel = T) + theme_classic()
```

```{r}
fviz_eig(df_pca, addlabels = T) + theme_classic()
```

## **Radar Chart** {.tabset}

```{r}
max_min <- data.frame(
  X1 = c(100, 0), X2 = c(100, 0), X3 = c(100, 0),
  X4 = c(100, 0), X5 = c(100, 0), X6 = c(100, 0),
  X7 = c(100, 0), X8 = c(100, 0), X9 = c(100, 0),
  X10 = c(100, 0), X11 = c(100, 0) 
)
rownames(max_min) <- c("Max", "Min")
data <- dtx; colnames(data) <- paste0("X", 1:11); row.names(data) <- raw.data2$Provinsi
df <- rbind(max_min, data)
```

### Aceh - Kep.Riau

```{r}
aceh <- df[c("Max", "Min", rownames(data)[1]),]
radarchart(aceh)
for(i in 1:nrow(data)){
  chart <- radarchart(df[c("Max", "Min", rownames(data)[i]),])
  ggsave(paste0(rownames(data)[i], ".png") , chart, path = export.chart,
        dpi = 300, height = 12, width = 12)
}
```
