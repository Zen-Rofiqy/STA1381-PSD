---
title: "Perbandingan Performa Model Regresi OLS, WLS, Ridge, dan Lasso"
author: "Angga Fathan Rofiqy"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmdformats::downcute:
    self_contained: true
    thumbnails: false
    lightbox: true
    gallery: true
    highlight: tango
    code_folding: show
    toc_depth: 3
    number_sections: true
    toc_float:
      collapsed: true
      smooth_scroll: true
    fig_caption: true
pkgdown:
  as_is: true
editor_options: 
  markdown: 
    wrap: 72
---

```{r message=FALSE, warning=FALSE, include=FALSE}
#                      -=( Install & Load Package Function )=-
install_load <- function (package1, ...)  {   

   # convert arguments to vector
   packages <- c(package1, ...)

   # start loop to determine if each package is installed
   for(package in packages){

       # if package is installed locally, load
       if(package %in% rownames(installed.packages()))
          do.call('library', list(package))

       # if package is not installed locally, download, then load
       else {
          install.packages(package)
          do.call("library", list(package))
       }
   } 
}
```

```{r, include=FALSE}
path <- function(){
  gsub  ( "\\\\",  "/",  readClipboard ()  )
}
#Copy path, Panggil function di console
#Copy r path, paste ke var yang diinginkan
```

# PSD Challange

**Prediksi AHH Pasien BPJS Penderita Diabetes Mellitus Menggunakan Model
Regresi Linear**

**Case:** Melakukan **pemodelan regresi** (klasik/lasso/ridge/step
function/polinomial/spline/smooth spline) untuk **menduga** Usia Harapan
Hidup **(UHH)** Pasien BPJS Penderita Diabetes Mellitus **tahun 2022**.

> **Goal:**Â R-Square terbaik

## Peubah

| **Peubah** | **Sebagai Peubah** | **Keterangan**                                       | **Tipe Peubah** |
|---------------|---------------|-----------------------------|---------------|
| `UHH`      | `Y`                | Usia Harapan Hidup                                   | *Numerik*       |
| `PSTV04`   | `X1`               | Hubungan Keluarga                                    | *Kategorik*     |
| `PSTV05`   | `X2`               | Jenis Kelamin                                        | *Kategorik*     |
| `PSTV06`   | `X3`               | Status perkawinan                                    | *Kategorik*     |
| `PSTV07`   | `X4`               | Kelas rawat                                          | *Kategorik*     |
| `PSTV08`   | `X5`               | Segmentasi peserta                                   | *Kategorik*     |
| `PSTV09`   | `X6`               | Provinsi Tempat Tinggal Peserta                      | *Kategorik*     |
| `PSTV10`   | `X7`               | Kabupaten/Kota Tempat Tinggal Peserta                | *Kategorik*     |
| `PSTV11`   | `X8`               | Kepemilikan faskes                                   | *Kategorik*     |
| `PSTV12`   | `X9`               | Jenis faskes                                         | *Kategorik*     |
| `PSTV13`   | `X10`              | Provinsi Fasilitas Kesehatan Peserta Terdaftar       | *Kategorik*     |
| `PSTV14`   | `X11`              | Kabupaten/Kota Fasilitas Kesehatan Peserta Terdaftar | *Kategorik*     |

# Packages

```{r}
install_load("MultiKink","ggplot2","dplyr","purrr","car",
         "hrbrthemes","MLmetrics","splines","ggcorrplot","ISLR","hrbrthemes")
```

# Data

## Input Data

```{r message=FALSE, warning=FALSE}
install_load('rio')
raw.data1 <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1381-PSD/main/Tugas/TM%202/Train.csv")
data_train <- raw.data1

raw.data2 <- import("https://raw.githubusercontent.com/Zen-Rofiqy/STA1381-PSD/main/Tugas/TM%202/Test.csv")
data_test <- raw.data2
```

```{r, echo=FALSE}
cat("Banyaknya Data Train :", nrow(raw.data1), "(", 
    nrow(raw.data1)/( nrow(raw.data1) + nrow(raw.data2) ) * 100, "%)",
    "\nBanyaknya Data Test  :", nrow(raw.data1), "(", 
    nrow(raw.data2)/( nrow(raw.data1) + nrow(raw.data2) ) * 100, "%)",
    "\nTotal Data Test dan Train :", ( nrow(raw.data1) + nrow(raw.data2) ) )
```

## Data Cleaning

### Tipe Data

```{r}
str(data_train)
```

Tipe blm sesuai, seharusnya selain UHH memiliki tipe data kategorik.

```{r}
str(data_test)
```

Tipe blm sesuai, seharusnya semuanya kategorik.

```{r message=FALSE, warning=FALSE}
install_load('dplyr')
data_train <- raw.data1 %>%
  mutate(across(everything(), as.factor),
         UHH = as.numeric(UHH))
str(data_train)
```

Tipe Data Train Sudah Sesuai.

```{r}
data_test <- raw.data2 %>%
  mutate(across(everything(), as.factor))
str(data_test)
```

Tipe Data Test Sudah Sesuai.

### Isi Data

**Kesamaan antar kolom**

```{r}
colnames(data_train %>% select(-UHH)) == colnames(data_test)
```

Semua kolom sudah sama.

**Kesamaan levels dari factor**

```{r}
lapply(data_train %>% select(-UHH), function(col) nlevels(col) ) ==
lapply(data_test, function(col) nlevels(col) )

lapply(data_train %>% select(-UHH), function(col) nlevels(col) )
```

# Regresi

## Regresi Dummy

```{r}
model  <- lm(UHH ~ PSTV04 +PSTV05 +PSTV06 +PSTV07 +PSTV08 +PSTV09 +PSTV10 
             +PSTV11 +PSTV12 +PSTV13 +PSTV14, data=data_train)
summary(model)
```

# Regresi Ridge

```{r}
# Membuat matriks x
x <- cbind(x1,x2,x3,x4,x5,x8,x9)

library(glmnet)
model2 <- cv.glmnet(x,y,alpha=0) #pemilihan lambda dgn cv untuk ridge
summary(model2)
coef(model2,s="lambda.min")
```

```{r}
# Melatih model Ridge pada seluruh data_train dengan lambda terbaik
best_lambda <- model2$lambda.min
ridge_model <- glmnet(x, y, alpha = 0, lambda = best_lambda)

# Menghitung prediksi
y_pred <- predict(ridge_model, newx = x, s = best_lambda)

# Menghitung R-squared disesuaikan
n <- nrow(x)
p <- length(coef(ridge_model))
adj_r_squared <- 1 - ((n - 1) / (n - p - 1)) * (sum((y - y_pred)^2) / sum((y - mean(y))^2))

# Tampilkan nilai Adjusted R-squared
cat("Adjusted R-squared:", adj_r_squared)
```

Didapatkan nilai adjusted R-Squared sebesar 0.2330.

# Regresi Lasso
